---
layout: post
title:  "golang编织方式"
date:   2021-06-27
excerpt: "简介在做golang切面时不同的编织方式，手段"
feature: https://cdn.justice-love.com/image/jpg/bjfj1.jpg
tag:
- go
- aspect
comments: true
---

## 简介

在做个人项目[go-aspect](https://github.com/Justice-love/go-aspect) 过程中，经历过多种编织方式，这种方式的递进，主要的思路是建立在尽可能减少对原业务代码的影响，接下来会按顺序逐个介绍下不同的编织方式。

### 直接在原方法内编织

这种方式是最直接也是最容易想到的方式，直接在待织入的代码在编译时织入到对应的方法中，比较直接，比较容易实现，但对原业务代码的影响也是最大的，主要集中在一下几点
1. 不利于around环绕模式切入
2. 对原业务代码行数的影响较大，主要是日志中显示的代码行数和源码不同
3. 切入代码和原业务代码柔和在一起，不利于后续排查问题

### 在源代码尾部进行追加

这种方式需要使用新追加的方法来替代原方法，修改原方法的方法名，在尾部新方法中使用target方式进行调用原方法，这种方式的好处是将切入的代码和原业务代码进行分离，减少了对原方法的影响，但也有几点问题
1. 实现较第一种方式更为复杂
2. 切入代码引入的import，同样会影响代码行数，但相较于第一种方式要小很多
3. 修改了方法名，日志中显示的调用方法名与源码不同
4. 对defer方式无效

### 在新文件中进行追加

这种方式主要是对上一种方式import问题的优化，新建一个新文件，则其import可以独立引入，不会对源文件产生影响，但其他问题仍然存在，这也是目前[go-aspect](https://github.com/Justice-love/go-aspect) 项目使用的方式

## 总结

以上是本人在做[go-aspect](https://github.com/Justice-love/go-aspect) 项目时对编织手段的一种递进，最后一种方式是目前已经支持的，后续如果有更好的方案会持续优化。